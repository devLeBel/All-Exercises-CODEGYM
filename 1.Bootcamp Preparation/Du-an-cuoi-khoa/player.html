<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Player - MusicMini</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- THANH SIDEBAR -->
  <aside class="sidebar">
    <h1>MusicMini</h1>
    <nav>
      <a href="index.html">üè† Trang ch·ªß</a>
      <a href="#"><span>üèÜ</span>&nbsp;Top 100</a>
      <a href="#"><span>üìà</span>&nbsp;B·∫£ng x·∫øp h·∫°ng</a>
      <a href="#"><span>üé§</span>&nbsp;Ngh·ªá sƒ©</a>
      <a href="#"><span>üíø</span>&nbsp;Album</a>
    </nav>
  </aside>

  <!-- KHU V·ª∞C CH√çNH -->
  <div class="main">
    <div class="player-container" id="noiDungPlayer"></div>
  </div>

  <script src="data.js"></script>
<script>
    // 1. Tr·∫£ v·ªÅ danh s√°ch b√†i h√°t
    document.addEventListener("DOMContentLoaded", function() {
      const ds = layDanhSachBaiHat();
      hienThiDanhSach(ds, "dsBaiHat");
    });

    // 2. Chuy·ªÉn s·ªë gi√¢y th√†nh chu·ªói MM:SS
    function chuyenThoiGian(sec) {
      var phut = Math.floor(sec / 60);
      var giay = Math.floor(sec % 60);
      if (giay < 10) { giay = "0" + giay; }
      return phut + ":" + giay;
    }

    // 3. T·∫°o giao di·ªán player v√† g√°n s·ª± ki·ªán
    function taoPlayer(baiHat, chiSo, danhSach) {
      var box = document.getElementById("noiDungPlayer");
      box.innerHTML = `
        <img id="diaThan" src="${baiHat.cover}" alt="${baiHat.tieuDe}">
        <h2>${baiHat.tieuDe}</h2>
        <h3>${baiHat.ngheSi}</h3>
        <audio id="trinhPhat" src="${baiHat.file}"></audio>
        <div class="controls">
          <button id="nutTruoc">‚èÆÔ∏è</button>
          <button id="nutPhatDung">‚ñ∂Ô∏è</button>
          <button id="nutSau">‚è≠Ô∏è</button>
        </div>
        <div class="progress-container">
          <span id="thoiHienTai">0:00</span>
          <input type="range" id="thanhTienTrinh" value="0" step="1" min="0">
          <span id="tongThoiLuong">0:00</span>
        </div>
        <div class="volume-container">
          <button id="nutMute">üîä</button>
          <input type="range" id="thanhAmLuong" min="0" max="1" step="0.01" value="1">
        </div>
      `;

      // Tham chi·∫øu c√°c ph·∫ßn t·ª≠
      var audio       = document.getElementById("trinhPhat");
      var btnPlay     = document.getElementById("nutPhatDung");
      var btnPrev     = document.getElementById("nutTruoc");
      var btnNext     = document.getElementById("nutSau");
      var progBar     = document.getElementById("thanhTienTrinh");
      var timeNow     = document.getElementById("thoiHienTai");
      var timeTotal   = document.getElementById("tongThoiLuong");
      var btnMute     = document.getElementById("nutMute");
      var volBar      = document.getElementById("thanhAmLuong");
      var diaThan     = document.getElementById("diaThan");

      // 4. Play / Pause
      btnPlay.onclick = function() {
        if (audio.paused) {
          audio.play();
          btnPlay.textContent = "‚è∏Ô∏è";
        } else {
          audio.pause();
          btnPlay.textContent = "‚ñ∂Ô∏è";
        }
      };

      // 5. Prev / Next
      btnPrev.onclick = function() {
        var m = (chiSo - 1 + danhSach.length) % danhSach.length;
        taoPlayer(danhSach[m], m, danhSach);
      };
      btnNext.onclick = function() {
        var m = (chiSo + 1) % danhSach.length;
        taoPlayer(danhSach[m], m, danhSach);
      };

      // 6. Khi metadata s·∫µn s√†ng ‚Üí thi·∫øt l·∫≠p max c·ªßa progress v√† t·ªïng th·ªùi l∆∞·ª£ng
      audio.addEventListener("loadedmetadata", function() {
        progBar.max      = Math.floor(audio.duration);
        timeTotal.textContent = chuyenThoiGian(audio.duration);
      });

      // 7. C·∫≠p nh·∫≠t progress v√† th·ªùi gian hi·ªán t·∫°i
      audio.addEventListener("timeupdate", function() {
        progBar.value         = Math.floor(audio.currentTime);
        timeNow.textContent   = chuyenThoiGian(audio.currentTime);
      });
      
      progBar.oninput = function() {
        audio.currentTime = this.value;
      };

      // 8. ƒêi·ªÅu ch·ªânh √¢m l∆∞·ª£ng & mute
      volBar.oninput = function() {
        audio.volume = this.value;
        audio.muted  = false;
        btnMute.textContent = "üîä";
      };
      btnMute.onclick = function() {
        audio.muted  = !audio.muted;
        btnMute.textContent = audio.muted ? "üîá" : "üîä";
      };

      // 9. Xoay ƒëƒ©a khi play, d·ª´ng xoay khi pause ho·∫∑c k·∫øt th√∫c
      audio.addEventListener("play", function() {
        diaThan.style.animationPlayState = "running";
      });
      audio.addEventListener("pause", function() {
        diaThan.style.animationPlayState = "paused";
      });
      audio.addEventListener("ended", function() {
        diaThan.style.animationPlayState = "paused";
        btnNext.click(); // t·ª± next khi h·∫øt b√†i
      });
    }

    // 10. Kh·ªüi t·∫°o player khi trang load
    document.addEventListener("DOMContentLoaded", function() {
      var params   = new URLSearchParams(location.search);
      var idBaiHat = parseInt(params.get("song")) || 1;
      var list     = layDanhSachBaiHat();
      var idx      = list.findIndex(function(x) { return x.id === idBaiHat; });
      if (idx < 0) { idx = 0; }
      taoPlayer(list[idx], idx, list);
    });
  </script>

</body>
</html>
